# Session: 2026-02-15 (Part 2 — afternoon)

## ZozoBet Fixes Deployed
- **commenceTime String→Date**: 815 events fixed. MongoDB $gte doesn't work with string vs Date comparison
- **Limit 100→500**: Was cutting off events. Increased to show all matching
- **12h filter → live+3h upcoming**: Changed from showing everything in 12h window to: events with scores (live) OR starting within 3 hours
- **Stale event cleanup**: aggregator marks events as completed if not in inplay AND started 90min+ ago (was 3h)
- **Rate limit fix**: delay 300ms→2000ms, batch 100→30, interval 5min→10min, stopped sandbox aggregator. Was burning 4800+/hour > 3600 limit
- **Match timers**: TM (minute) + GO (period) from inplay stored as matchMinute/matchPeriod in DB
- **bet365-style modal**: Koder redesigned match modal with accordion markets
- **Bet editing fix**: Admin can now edit/void bets, hierarchical view (superagent→agent→player)
- **Weekly reset + datepicker**: Period system for admin, history up to 4 weeks back
- **Void refund**: Cancelling bet returns stake to user balance

## Agent System Improvements
- **sessions_spawn for parallelism**: Discovered sessions_send blocks (serial), sessions_spawn runs in background (parallel). Up to 8 concurrent.
- **SYSTEM.md updated with**:
  - SELF-TEST mandatory (step 3)
  - REFLECTION step (5 questions before "done")
  - learn.sh query BEFORE starting work
  - guard.sh pre-done gate
  - progress.sh auto-reporting
  - auto-update.sh for General notifications
- **ORCHESTRATOR.md updated**: sessions_spawn instead of sessions_send for parallel work
- **reflect.sh created**: Reflection tool for agents
- **Learning system fixed**: 12 lessons, inject command, evolve threshold lowered, 5 auto-skills generated
- **Scores reset**: worker/tzayar/researcher 100%→50% (no data)
- **Dashboard fixed**: /api/agents returns real data from agents.json + active-context.md + scores.json

## Key Yossi Complaints (Must Remember!)
- "למה כל פעם אני צריך לשאול?" — Agents don't proactively report progress
- "הסוכנים לא באמת עובדים במקביל" — sessions_send is serial, use sessions_spawn
- "הוא סתם אומר הושלם ולא באמת בדק" — Agents claim done without testing
- "למה לא משתמש בעוד סוכנים?" — Always split tasks to multiple agents
- "לא נפתחו נושאים" — sessions_spawn is internal, doesn't post to Telegram

## Architecture Notes
- sessions_spawn = background sub-agent, no Telegram visibility
- sessions_send = blocks, but posts to Telegram topic
- Best approach: sessions_spawn for work + send.sh for Telegram visibility
- BetsAPI rate: 3600/hour. Background uses ~320/hour after fix
- Aggregator: basic odds every 10min (30 events), live sync every 30sec, INTERVAL=10min

## SYSTEM.md New Features Added
- **FEEDBACK LOOP (Step 2b)**: Every code change → run → check output → fix → repeat. "Every 5 min = at least 1 run"
- **REFLECTION (Step 3b)**: 5 mandatory questions before "done" (what could break? edge cases? side effects?)
- **PRE-WORK**: learn.sh query before starting any task
- **PRE-DONE GATE**: guard.sh pre-done must PASS
- **learn.sh inject**: Returns lessons as injectable prompt text, auto-increments applied counter

## Active Topics (end of session)
- #2408 — Dashboard live agent status + sub-agents (koder working)
- #2289 — Profit/loss report + agent commissions (koder — deployed?)
- #2304 — Weekly reset + history (deployed)
- #2306 — Void refund (deployed)

## Yossi's Core Frustrations (REMEMBER!)
1. Agents say "done" without testing → FEEDBACK LOOP + guard.sh
2. I have to keep asking "what's happening" → progress.sh + auto-update.sh  
3. Agents don't work in parallel → sessions_spawn
4. Dashboard doesn't show who's working → task #2408
5. Do agents actually improve? → Learning system fixed but still early
