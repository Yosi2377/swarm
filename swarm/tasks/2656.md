# Task 2656 — פירוט רווח/הפסד בפאנל ניהול ZozoBet

## בעיה
בפאנל ניהול, עמודת "רווח/הפסד" מראה מספר (למשל -4,437₪) אבל אין פירוט מאיפה הוא מגיע.

## מה צריך
כשלוחצים על שורה של משתמש (או על המספר ברווח/הפסד), נפתח מודל/טבלה עם פירוט:

### טבלת פירוט:
| תאריך | משחק | שוק | בחירה | סכום | אודס | תוצאה | רווח/הפסד |
|-------|------|-----|-------|------|------|--------|-----------|
| 15/02 | ברצלונה vs ריאל | 1X2 | ברצלונה | 500₪ | 2.10 | הפסד | -500₪ |
| 15/02 | Lakers vs Bulls | Over/Under | Over 210.5 | 200₪ | 1.90 | ניצחון | +180₪ |

### שורת סיכום:
- סה"כ הימורים: 15
- סה"כ ניצחונות: 5
- סה"כ הפסדים: 8
- סה"כ פתוחים: 2
- סה"כ רווח/הפסד: -4,437₪
- Win rate: 33%

## טכני

### Backend — endpoint חדש או קיים
GET /api/bets?userId=XXX&periodId=current
- מחזיר כל הימורים של המשתמש בתקופה הנוכחית
- כולל: eventName, market, selection, amount, odds, status, pnl

### Frontend — admin.html
- לחיצה על שורת משתמש או על מספר רווח/הפסד → פותח מודל
- מודל עם טבלה מפורטת (RTL, עברית)
- צבעים: ירוק לרווח, אדום להפסד, אפור לפתוח
- שורת סיכום בתחתית

## Sandbox
- עבוד ב-sandbox: /root/sandbox/BettingPlatform
- Service: sandbox-betting-backend (port 9301)
- URL: http://95.111.247.22:9089
- DB: betting_sandbox

## Browser Tests
- exists: #modalPnlDetail → "מודל פירוט רווח/הפסד קיים"
- click: td[onclick*="showPnlDetail"] → waitFor: #modalPnlDetail.on → "לחיצה על רווח/הפסד פותחת פירוט"
- count: .pnl-row → min: 1 → "יש שורות פירוט" (needs bets data)
- text: #pnlDetailSummary → contains: ₪ → "סה"כ מוצג"
- exists: #pnlDetailBody → "טבלת פירוט קיימת"

## Status: ✅ DONE

### What was built:
1. **Backend**: `GET /api/bets/user/:userId` in `routes/bets.js`
   - Returns per-bet details: eventName, market, selection, amount, odds, status, pnl
   - Summary: total, wins, losses, open, void, totalPnl, winRate
   - Supports date filtering (from/to query params)
   - Admin-only auth

2. **Frontend**: PNL Detail Modal in `admin.html`
   - Click on any user's P&L number → opens modal with full breakdown
   - Summary cards: total bets, wins, losses, win rate, total P&L
   - Table: date, event, market, selection, amount, odds, result, P&L
   - Color coded: green=win, red=loss, gray=open
   - RTL Hebrew, close with ✕ button
   - Respects date range filters

### Tested:
- ✅ `curl /api/bets/user/:userId` returns correct JSON with pnl calculation
- ✅ won: pnl = potentialWin - stake
- ✅ lost: pnl = -stake  
- ✅ cashed_out: pnl = cashoutAmount - stake
- ✅ Service restarts cleanly
