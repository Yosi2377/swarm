# 2026-02-07

## Blackjack WebGL - Shader Color Debugging (18:16 - 19:08)

### The Problem
Table appears dark brown/beige instead of green in WebGL. User confirmed from his real browser too.

### Builds 13-16 Summary
| Build | Change | Result |
|-------|--------|--------|
| 13 | Gamma color space (m_ActiveColorSpace: 0) | Still brown |
| 14 | Bright green (0.1, 0.5, 0.2) + direct material mod | Still brown |
| 15 | Custom SimpleColor.shader (CGPROGRAM vertex/fragment) | Small green rect visible! Table beige (TableFelt texture loaded via wrong path) |
| 16 | Force green color on table (skip TableFelt texture) | **PENDING USER TEST** |

### Key Discovery (Build 15)
- Custom `SimpleColor.shader` at `Assets/Resources/SimpleColor.shader` WORKS in WebGL!
- Saw a green rectangle on VPS Firefox = shader displays colors correctly
- BUT the table was beige because it loaded `TableFelt.png` texture via `TextureLoader.TableFelt`
- The texture loaded but displayed through wrong shader path

### Fix in Build 16
- Changed Table3D.cs to skip texture loading, use `ShaderHelper.CreateMaterial(casinoGreen)` directly
- This forces the custom shader + procedural green color texture

### Custom SimpleColor Shader
```
Shader "Custom/SimpleColor" - at Assets/Resources/SimpleColor.shader
- Minimal CGPROGRAM vertex/fragment
- tex2D(_MainTex, i.uv) * _Color
- No lighting, no PBS, no Standard shader complexity
- Fallback: Unlit/Color
```

### ShaderHelper Load Order
1. `Shader.Find("Custom/SimpleColor")`
2. `Resources.Load<Shader>("SimpleColor")`
3. Scene ref `__UnlitTextureRef__`
4. Shader.Find fallbacks (Unlit/Texture, Unlit/Color, Sprites/Default)
5. Primitive shader

### Current State
- Build 16 deployed at http://95.111.247.22:8080
- Awaiting user test of green table
- Server: python3 http.server 8080 in Builds/WebGL/
- Custom HTML loading screen with logo, progress bar

### All Debugging Attempts (Builds 7-16)
- ShaderHelper with primitive shader extraction â†’ brown
- Explicit SetColor("_Color") â†’ brown  
- Unlit/Texture shader â†’ null at runtime â†’ fallback â†’ brown
- Color textures (Texture2D.SetPixels) + Standard shader â†’ brown
- Scene reference object for shader â†’ brown
- Gamma color space â†’ beige (lighter but still wrong)
- Direct primitive material modification â†’ beige
- **Custom SimpleColor CGPROGRAM shader â†’ GREEN!** âœ…
- Skip TableFelt texture, use color directly â†’ Build 16 pending

### Build 17-18 (19:10 - 19:55)

**Build 17**: Fixed ShaderHelper double-color bug (colorÂ² = dark), added AI texture loading for TableFelt. Still showed brown because rim was taller than surface.

**Build 18**: Fixed rim/surface height overlap. **TABLE IS GREEN WITH AI TEXTURE!** ðŸŽ‰
- ShaderHelper now uses white texture + _Color (not colorTexture * _Color)  
- Table3D loads TableFelt.png via TextureLoader
- Surface raised above rim (y=0.05 vs rim y=-0.01)
- Card3D already uses CardBack texture

### Build 19-21 (19:56 - 20:18)

**Build 19**: Card3D switched to Plane mesh - still streaky
**Build 20**: Cull Off shader, thicker bet circles (0.02), Card3D back to Cube 0.03 thick - streaks shortened
**Build 21**: Major visual upgrade!
- Card3D: single Cube mesh 1.0x0.04x1.4, front/back material swap on flip
- CasinoBG.png sphere background (inverted normals) replacing black
- Table rotated 180Â° (text still backward - need different fix)  
- Card areas raised to y=0.25
- Cards now clearly visible with procedural suit textures (diamonds, spades)!
- Dealer shows face-up + hole card, player shows both cards

### Build 22-27 (20:16 - 21:15)
- **CardTextureGenerator rewrite**: 256x360 textures, pixel font for ranks (A-K), pip layouts for number cards, rounded corners, face card decoration
- **Table3D major simplification**: Removed ALL 3D elements (cylinders, bet circles, insurance lines, TextMesh). Single Plane with AI TableFelt texture handles everything
- **Key insight**: Cylinder rim was BLOCKING the felt texture from camera angle. Solution: remove cylinder entirely, let texture provide the wooden rim look
- **Surface**: Plane scale 1.3x0.85, rotated 180Â° Y for correct text orientation
- **CasinoBG sphere**: Inverted-normals sphere with VIP room texture
- **Fog removed, ambient light raised** for cleaner brighter look
- **ShaderHelper fix**: Was doing colorÂ² (texture*color both set to same value). Now uses white texture + _Color
- **Shader**: Added Cull Off for double-sided rendering
- Build 27: Professional look! Full table texture visible, cards with pips/numbers, VIP background, no artifacts

### Builds 27-37 (21:15 - 00:30)
- Fixed table: removed cylinder rim entirely, single Plane with AI felt texture
- Generated AI assets with Nano Banana Pro: UIButtons.png (HIT/STAND/DOUBLE/SPLIT), UIPanel.png, ChipSet.png
- Split button images into individual PNGs, cropped to 320x320
- CreateStyledButton uses AI textures for action buttons, gradient fallback for others
- CreateChipButton uses AI chip textures ($1-$1000)
- Action panel moved to bottom of screen (anchor bottom, y=10)
- Card positioning: dealer z=2.2, player z=-0.5
- Card size reduced to 0.9x1.26 from 1.0x1.4
- SPLIT button still slightly cut off at right edge

### Current State (Build 37)
- **Working**: Table felt texture, card dealing, hit/stand/double, betting, card textures with ranks/suits/pips, VIP background
- **Server**: python3 http.server 8080 on Builds/WebGL/
- **URL**: http://95.111.247.22:8080

### Remaining Work
- Multiplayer networking (WebSocket/Photon)
- Sound effects
- Card deal animations could be smoother
- Mobile responsiveness
- Loading screen with custom logo (was working before)
