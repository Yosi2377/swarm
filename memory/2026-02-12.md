# 2026-02-12 - Betting Platform (BetPro) Built

## Project Created
- **Path**: `/root/BettingPlatform`
- **URL**: http://95.111.247.22:8089
- **Admin Panel**: http://95.111.247.22:8089/admin.html
- **Login**: admin / admin123 (case insensitive)
- **Services**: `betting-backend` (port 3001), `betting-aggregator` (port 3002)
- **Nginx**: port 8089 proxies both + aggregator via /agg/

## Architecture
- **Backend**: Node.js + Express + Socket.io + MongoDB + Redis (port 3001, localhost only)
- **Aggregator**: Smart Polling microservice with Socket.io (port 3002, localhost only)
- **Frontend**: Single HTML file at `/root/BettingPlatform/backend/public/index.html`
- **Admin**: `/root/BettingPlatform/backend/public/admin.html`
- **DB**: MongoDB `betting`, Redis with password 123456

## Smart Polling System
- Demand-based: 0 users = 0 API calls
- Per-sport rooms via Socket.io subscribe/unsubscribe
- Odds API: every 30 seconds per active sport
- SportScore: every 30 seconds (separate quota)
- Diff engine: only sends changes to clients
- Grace period: 60 seconds before stopping poll when no viewers
- Quota tracking in Redis with monthly auto-reset

## APIs
- **The Odds API**: key `7fe09240c22a6c2440e25f0ae9955138` (20k credits, was 500)
  - Old key `f9de4eb278b70372df31eb652a77f7cd` expired/quota used
- **SportScore (RapidAPI)**: key in `.env`
- Env file: `/root/BettingPlatform/.env`

## Features
- 3 betting markets: H2H (1X2), Spreads, Totals (Over/Under)
- Real-time odds updates via Socket.io (no page refresh)
- 8 sports/leagues: EPL, La Liga, Bundesliga, Serie A, Champions League, NBA, Euroleague, Boxing
- Hebrew RTL UI, BetPro branding (English logo)
- Mobile-first responsive design (Nano Banana Pro concepts used)
- Bet slip (desktop panel + mobile slide-up)
- Tabs: Sport | Live | Results | Statistics
- Admin panel: users CRUD, credit management, bets, transactions, events
- JWT httpOnly cookies, rate limiting, helmet headers
- Settlement engine (auto-settles bets when games complete)
- Cashout feature

## Security (fixed during build)
- Ports 3001/3002 bound to localhost only (were exposed)
- CORS restricted to our domain
- Login case-insensitive (Yossi typed "Admin" not "admin")

## Design
- Generated UI concepts with Nano Banana Pro (Gemini image gen)
- Mobile mockup: `/root/betting-ui-concept-mobile.png`
- Desktop mockup: `/root/betting-ui-concept-desktop.png`
- Dark theme: #0d1b2a bg, #00c853 accent green, #ffd700 gold, #ff3d57 red
- Font: Heebo (Hebrew)
