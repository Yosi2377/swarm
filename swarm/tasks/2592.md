# Task 2592 — בדיקות Browser אמיתיות ב-Evaluator

## בעיה
evaluator.sh בודק רק curl (HTTP status). לא בודק איך הדף באמת נראה/עובד בדפדפן.

## פתרון — Puppeteer browser tests

### 1. צור swarm/browser-eval.js
סקריפט Node.js שמקבל URL + בדיקות ומריץ Puppeteer:

```javascript
// Usage: node browser-eval.js <url> <test-file.json>
// test-file.json:
// {
//   "url": "http://95.111.247.22:8090",
//   "tests": [
//     {"type": "exists", "selector": "h1", "desc": "Header exists"},
//     {"type": "text", "selector": ".title", "contains": "Dashboard", "desc": "Title shows Dashboard"},
//     {"type": "count", "selector": ".agent-card", "min": 1, "desc": "At least 1 agent card"},
//     {"type": "click", "selector": "#refresh-btn", "waitFor": ".data-loaded", "desc": "Refresh button works"},
//     {"type": "noErrors", "desc": "No JS console errors"},
//     {"type": "screenshot", "path": "/tmp/eval-browser-THREAD.png"}
//   ]
// }

// Puppeteer config:
// executablePath: /root/.cache/puppeteer/chrome/linux-145.0.7632.46/chrome-linux64/chrome
// headless: true, args: ['--no-sandbox']

// Output:
// PASS: 5/5 browser tests passed
// or
// FAIL: 3/5 browser tests passed
//   ❌ "Refresh button works" — element #refresh-btn not found
//   ❌ "No JS errors" — TypeError: Cannot read property 'map' of undefined
```

### 2. צור בדיקות לכל פרויקט

swarm/browser-tests/dashboard.json:
- Header exists
- LIVE badge visible
- Agent cards exist (>0)
- Tasks list visible
- No JS errors
- Screenshot

swarm/browser-tests/betting.json:
- Login page loads
- Events table has rows
- Modal opens on click (if events exist)
- No JS errors
- Screenshot

swarm/browser-tests/poker.json:
- Login page loads
- No JS errors
- Screenshot

### 3. עדכן evaluator.sh
אחרי curl tests, הרץ:
```bash
node swarm/browser-eval.js "$URL" "swarm/browser-tests/${PROJECT}.json"
```
אם נכשל → FAIL

### 4. עדכן test-runner.sh
הוסף browser tests כחלק מהבדיקות הרגילות.

## Tests
- node /root/.openclaw/workspace/swarm/browser-eval.js http://95.111.247.22:8090 /root/.openclaw/workspace/swarm/browser-tests/dashboard.json → PASS
- node /root/.openclaw/workspace/swarm/browser-eval.js http://95.111.247.22:8089 /root/.openclaw/workspace/swarm/browser-tests/betting.json → PASS
- bash -n /root/.openclaw/workspace/swarm/evaluator.sh
