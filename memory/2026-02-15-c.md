# Session: 2026-02-15 (Part 3 — afternoon continued)

## Major System Improvements Built Today

### Auto-Flow Pipeline (auto-flow.sh)
- Full automated task flow: agent works → evaluator → retry → screenshot → report
- Phase 1: 3 retries with same approach
- Phase 2: reflection + learn from errors + new approach + 3 retries
- Phase 2.5: web search (StackOverflow/GitHub) + 2 retries
- Total 8 attempts before escalating to Yossi
- Live-feed to Agent Chat (topic 479) at every step

### Evaluator System
- test-runner.sh — curl-based tests per project (betting 5/5, poker 2/2, dashboard 3/3)
- evaluator.sh — runs tests + browser tests + screenshots
- browser-eval.js — Puppeteer browser testing with auto-login for admin pages
- Feature-specific tests from ## Browser Tests section in task files
- **BUG FIXED**: evaluator was FAIL on uncommitted workspace files (lessons.json, task files) → changed to auto-commit
- **BUG FIXED**: browser-eval.js didn't login to admin pages → added auto-login by port

### Learning System
- learn.sh called on EVERY eval result (success + failure)
- learn.sh inject before agent starts (past lessons)
- learn.sh score tracks success/fail per agent
- eval-history.log saves all evaluator output

### Other Tools
- live-feed.sh — real-time progress in Agent Chat (topic 479)
- health-check.sh — monitors all services every 5min (cron)
- sync-sandbox-db.sh — syncs events+bets+transactions from prod→sandbox every 10min
- HEARTBEAT.md — checks for completed sub-agents and auto-reports

### Sandbox DB Separation
- Production: MongoDB `betting`
- Sandbox: MongoDB `betting_sandbox`
- sync-sandbox-db.sh copies events+bets+transactions one-way
- Sandbox aggregator BLOCKED (dummy systemd service)
- Sandbox backend uses MONGO_URI=mongodb://localhost:27017/betting_sandbox

### Key Rules Established
- IRON RULE in ORCHESTRATOR.md: Or never codes, everything through flow
- SYSTEM.md: feedback loop, reflection, write tests, git commit mandatory
- auto-flow.sh handles everything automatically — Yossi shouldn't need to ask "what's happening"

## Active Tasks
- #2656 — פירוט רווח/הפסד בפאנל ZozoBet (koder working, sandbox)
  - Modal opens but shows no data — bets field is `user` not `userId`
  - Browser tests: 3/5 passing
- #2592 — Browser tests in evaluator (was blocked by uncommitted files bug, now fixed)
- #2650 — Auto-report sub-agents (HEARTBEAT.md updated)

## Critical Bugs Found & Fixed
1. **evaluator uncommitted FAIL** — was blocking ALL evaluations. Every eval failed because workspace had task files/lessons changed. Fixed: auto-commit instead of FAIL
2. **browser-eval no login** — Puppeteer opened admin pages without auth, saw empty page. Fixed: auto-login by port
3. **sandbox aggregator keeps restarting** — agents keep starting it. Fixed: replaced with dummy service that refuses to start
4. **sandbox DB shared with production** — Fixed: separate betting_sandbox DB with one-way sync
5. **Bets field name** — DB uses `user` field (ObjectId), not `userId`

## Yossi Feedback Patterns
- "למה אתה לא מעדכן?" — sessions_spawn complete silently, need HEARTBEAT check
- "למה לא עשית commit?" — agents don't commit, need auto-commit in evaluator
- "למה הevaluator תמיד נכשל?" — was uncommitted files bug, not real failures
- "למה לא עבדת לפי הכללים?" — Or kept coding directly instead of delegating
- "תבדוק באינטרנט" — added Phase 2.5 web search before escalation
