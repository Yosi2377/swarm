
## Level 8 System — Ready for Testing

### What was built today:
1. **`swarm/delegate.sh`** — Full delegation wrapper: auto-injects lessons + skills into agent prompts. Usage: `bash swarm/delegate.sh <agent> "task" "keywords"`
2. **`swarm/inject-lessons.sh`** — TF-IDF search over lessons.json, returns top 5 relevant lessons. 0 tokens (bash only)
3. **`swarm/self-improve.sh`** — 5 bash checks: patterns, production health, CSS selectors, lesson quality, sandbox sync. 0 tokens
4. **`swarm/cron-self-improve.sh`** — Wrapper for cron, writes /tmp/watchdog-alert.json only when issues found
5. **Cron jobs**: `self-improve-morning` (10:00) + `self-improve-evening` (22:00) — bash only, agent wakes only on alert
6. **Lesson cleanup**: 122 → 57 lessons (removed eval fail spam + duplicates)
7. **Browser tests updated**: betting.json with correct selectors (featured-match, odd-btn, bet-slip, sidebar-left)
8. **Koder scores updated**: +5 successes (basketball, soccer, tennis, watched events, bet delay) → score 56%, streak +5

### Level 8 Status:
- Infrastructure: ✅ READY
- Tested in production: ⏳ PENDING — next task from Yossi will be the real test
- delegate.sh flow: task → inject-lessons → inject-skills → sessions_spawn → learn.sh score
- Token budget rule: cron = bash only, agent only when alert. No background token burn.

### Next Step:
Yossi wants to test the system with a real task. When new session starts, continue from here — run the task through delegate.sh and verify the full Level 8 flow works.

### Commit: 61b3df4 — "Level 8: self-improve system + inject-lessons + delegate wrapper + lesson cleanup"

## Session: BettingPlatform Updates (Topic 4950) — Evening

### Done
1. **Odds stale warning inline** — moved from toast to inside match page with animation (bigger, bounce, pulse, glow)
2. **Bet failed warning inline** — same treatment
3. **maxExposure** — Zozo raised to 500K, added "מקסימום חשיפה" field in admin edit user modal
4. **Prematch sidebar** — clicking sport shows "אירועי היום" + future dates with event counts (no more league list clutter)
5. **Prematch page** — dark theme table view with league grouping, time, 1X2 odds, +markets count, date tabs (dynamic — only dates with events)
6. **PnL table 212bet style** — columns: ID, username, active, %, open bets, bet count, turnover, money at risk, bonus, net, agent share (85%), super agent share (5%), house share (10%), summary row
7. **isLive bug fix** — koder agent added `isLive` field to Event model + aggregator sets true/false + frontend `isLiveEv()` uses `e.isLive===true`
8. **Server-side odds_stale** — fixed `bets.js` to use `freshEvent.isLive===true` instead of `scores?.home!=null`
9. **Sandbox synced** — all production files copied back to sandbox

### Lessons
- Koder agent worked on production directly — lesson saved (critical). Must enforce sandbox-first in agent prompts.
- BetsAPI returns `scores:{home:0,away:0}` on prematch — can't rely on scores for live detection
- `0 != null` is true in JS — need explicit boolean field

### Key Files Modified
- `backend/public/index.html` — isLiveEv(), showMatchWarn(), prematch view, odds_stale/bet-fail inline
- `backend/public/admin.html` — maxExposure field, PnL table with shares
- `backend/src/routes/admin.js` — betCount, openBets, payout in aggregation
- `backend/src/routes/bets.js` — isLive check fix
- `backend/src/models/Event.js` — isLive field
- `aggregator/src/index.js` — isLive:true on inplay, false on prematch
- `aggregator/src/inplay-parser.js` — isLive:true
