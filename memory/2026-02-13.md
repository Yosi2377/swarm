# 2026-02-13 — Major Day: Flow Enforcement, Sandbox, Browser Toolkit

## Swarm Research (topic 1368) — DONE
- Worker researched CrewAI, AutoGen, MetaGPT, ChatDev, LangGraph
- Finding: 3-5 agents optimal (we have 5 = sweet spot)
- agents.json upgraded to v4: description, backstory, constraints, keywords
- Vault + shared memory created

## Sandbox Environment (topic 1394)
- Yossi's idea: clone project to sandbox, work there, apply back only on success
- sandbox.sh: create/test/apply/destroy
- Port mapping: production → sandbox (8088→9088, 7001→9001, etc.)

## Enforcement System (topic 1443) — DONE
- Problem: agents ignore protocols (no sandbox, no screenshots, no review)
- enforce.sh: pre-work/post-work/review/check-sandbox → PASS/FAIL
- SYSTEM.md shortened to ~60 lines, 3 iron rules: SANDBOX, PROOF, REPORT

## Flow Improvements — KEY DECISIONS
1. **No agent confirmation step** — agents ask "להתחיל?" then lose context when user replies. Fix: orchestrator (אור) confirms with user, then sends agent everything in one message → agent starts immediately
2. **User approval before production push** — NEVER push sandbox to production without asking Yossi first. Show screenshots + sandbox link, ask "לדחוף?"
3. **Screenshots must show actual work** — not login pages! If fixing card animation, screenshot must show cards mid-animation. If fixing a button, screenshot must show the button changed.

## Poker: Card Animation (topics 1450, 1547) — PUSHED TO PRODUCTION
### Changes (game.vue only):
- Flop: 3 cards reveal one by one (500ms delay)
- All-In: player hands first → 1s → community cards one by one (500ms) → 3s to see board → winner message → 5s display → cleanup
- `isAnimatingCards` flag prevents `init()` from clearing cards during animation
- `pendingInit` defers cleanup if `newGame` event arrives during animation
- Normal gameOver path also protected with 5s display time
- Previous attempt broke things (cards vanishing, winner message too early, can't play next game) — fixed by protecting init() and proper timing

## Poker: CREATE ACCOUNT button — DONE
- Was showing despite previous fix (build was stale)
- Rebuilt Vue client, now shows "To create an account, contact the administrator"

## Puppeteer + Browser Toolkit (topic 1591) — DONE
### browser-test.sh (old, simple):
- screenshot, multi-screenshot, test-poker, eval

### browser.sh + browser-server.js (NEW, session-based):
- Node.js server on port 9222, persistent browser sessions
- Commands: start, goto, login, click, type, wait, screenshot, scroll, text, exists, stop
- Multi-session: --session=p1 / --session=p2 for testing with 2 players
- Auto-screenshot on every action → /tmp/browser-*.png
- Generic — works on any project (poker, blackjack, betting, anything)
- Agent decides what to test based on task, not hardcoded script

### Sandbox nginx:
- /etc/nginx/sites-available/sandbox-poker on port 9088
- Points to /root/sandbox/TexasPokerGame
- Sandbox server runs on port 9001

## Pending Topics
- Topic 883: 6 swarm upgrades (permissions, backup, weekly report, rating, cancel, timeout)
- Topic 906: Dashboard real-time update
- Topic 1065: Agent v3 upgrades (Plan Review, Quality Gates, Workflows)
- Topic 1368: Research completed ✅
- Topic 1394: Sandbox — built ✅
- Topic 1443: Enforcement — built ✅ 
- Topic 1547: Card animation — pushed ✅
- Topic 1591: Browser toolkit — built ✅

## ZozoBet HTTPS — DONE
- Got proper SSL cert for zozobet.duckdns.org (was using sslip.io cert before)
- certbot webroot, expires 2026-05-14, auto-renew
- DuckDNS updated: zozobet → 95.111.247.22
- nginx config: /etc/nginx/sites-available/betting (HTTP redirect + HTTPS + port 8089)

## ZozoBet 7 Upgrades (topic 1631) — IN PROGRESS
Sent to koder:
1. Admin impersonate (login as any user)
2. User suspend (active/inactive toggle, inactive = can't login)
3. More sports/leagues (tennis, basketball NBA/EuroLeague, baseball, hockey, MMA, cricket)
4. Hebrew language (full RTL, EN/HE toggle)
5. Agent can't bet (block API + hide UI)
6. Agent panel (register users, list created users, delete, change password, no credits)
7. Success/failure toast after bet

## Updated Projects Table
| Project | Domain | HTTPS |
|---------|--------|-------|
| Poker | zozopoker.duckdns.org | ✅ |
| Blackjack | 95.111.247.22:3000 | ❌ |
| Betting | zozobet.duckdns.org | ✅ |
| Dashboard | tworkswarm.duckdns.org | ✅ |

## Key Lessons Today
1. **Agents lose context between messages** — send everything in ONE activation message
2. **Screenshots must prove the fix** — login page screenshots are useless for card animation bugs
3. **Never push to production without user approval** — always show sandbox first
4. **SYSTEM.md must be short** — long instructions get ignored by agents
5. **newGame event clears cards** — need isAnimatingCards flag to protect animations
6. **Browser testing needs session persistence** — can't just take static screenshots, need to login/navigate/interact
