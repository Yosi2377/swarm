# 2026-02-18 â€” Major Session

## Swarm System Levels 5.5-7.0
- Built scan-bugs.sh (Level 5.5), projects.json + project-task.sh (Level 6.0), evolve.sh (Level 6.5), spawn-agent.sh (Level 7.0)
- Meta-agent test: spawned SEO agent â†’ added schema.org structured data â†’ deployed
- 15 deploys today, 0 rollbacks

## Cron Jobs â†’ Bash Watchdog (CRITICAL CHANGE)
- **Removed all 7 AI cron jobs** â€” they burned Claude Max tokens (1,440+ AI calls/day!)
- Archived in `swarm/crons-archive/` (7 JSON files) for future restore
- **Replaced with `swarm/watchdog.sh`** â€” pure bash, systemd timer every 60s, 0 tokens
- Watchdog checks: services, HTTP, disk, MongoDB, stale odds, JS errors, 404s
- If bash finds code bug â†’ writes `/tmp/watchdog-alert.json` â†’ sends cron wake â†’ AI fixes
- systemd: `watchdog.timer` + `watchdog.service`

## ZozoBet Fixes
### New Markets Added
- 9 markets in popup: alt_totals, result_totals, btts_h1/h2, double_chance_h1, correct_score_h1, result_btts, ten_min_result, specials
- Backend: cards_total, both_teams_cards, player_shots, player_shots_on_target, goalkeeper_saves, betboost, goals_range, alt_corners, total_corners, team_corners
- Frontend: ğŸƒ Cards tab, ğŸš€ BetBoost tab, player shots in Players tab, goals range in Goals tab

### Tennis Odds Bug Fixed
- Was showing 1st_set_winner odds as h2h instead of to_win_match
- Fix: `to_win_match` gets priority over `full_time_result` in betsapi.js

### Basketball/Tennis Live Odds Fixed
- inplay_filter API returns empty odds for basketball/tennis
- But `/v3/bet365/event` endpoint returns full MG/PA data (30 MGs, 345 PAs for basketball!)
- Bug: `liveOddsUpdatedAt` field didn't exist â†’ query `$lt` didn't match
- Fix: added `$or` with `$exists: false` and `null` check
- Also increased limit from 5 to 8 events per cycle

### Quarter/Set Locking
- Added detection of current quarter (basketball) and current set (tennis)
- Past quarters/sets show ğŸ”’ with "×©×•×§ ×¡×’×•×¨" message

### Odds Rotation Fix
- 291 events with `odds: undefined` were never entering rotation
- Set `oddsUpdatedAt` to old date to force them into queue
- Batch-fixed: 35 basketball + 35 tennis events got prematch odds

### Pipeline Improvements
- gen-tests.sh: SKIP_CLASSES for dynamic selectors, MAX=10
- pipeline.sh: posts task details + progress + screenshot inside topic (was empty before)
- pipeline.sh: auto-injects lessons before task, auto-learns from failures after

## Feedback Loop (evolve.sh)
- Analyzes pipeline success rate
- Deduplicates lessons (found 25 duplicates, cleaned 130â†’105)
- Auto-fixes: reduced MAX_TESTS when tests-partial is common
- Agent performance scores by agent name

## Key Yossi Preferences (learned today)
- **Don't burn tokens** â€” bash for monitoring, AI only when needed
- **Screenshots required** â€” always show visual proof
- **Honest about capabilities** â€” don't overclaim system abilities
- **Sandbox first, approve for production** â€” Level B autonomy

## ZozoBet Redesign - Session Summary (Topic 4950)

### What was done:
1. **Hebrew/English team translation (T())** â€” 202 manual translations (TEAMS_HE) + 733 auto-transliterated (TEAMS_AUTO)
2. **Hebrew/English league translation (TL())** â€” 194 leagues in LEAGUES_HE
3. **Full i18n system** â€” I18N dict with t() function, all hardcoded Hebrew replaced
4. **Language toggle (ğŸŒ EN/HE)** â€” switches everything: teams, leagues, UI labels, nav, stats, mybets
5. **RTL â†” LTR** â€” full layout flip: sidebars swap sides, text alignment, direction
6. **Language persisted** in localStorage
7. **Live filter buttons** â€” ×›×“×•×¨×’×œ/×›×“×•×¨×¡×œ/×˜× ×™×¡ filter in live page with counts
8. **MyBets click â†’ popup** â€” openMatchFromBet() works even for finished matches
9. **Admin panel redesign** â€” blue+white theme matching main site (admin.html CSS rewrite)
10. **All pushed to production** â€” index.html + admin.html

### Key technical details:
- `T(name)` â€” checks TEAMS_HE first (manual), then TEAMS_AUTO (auto-transliterated), fallback to original
- `TL(name)` â€” league name translation from LEAGUES_HE dict
- `t(key)` â€” UI string translation from I18N dict
- `setLang(l)` / `toggleLang()` â€” switches LANG, sets dir/lang on html element, calls updateUILang + render
- `liveFilter` variable + `setLiveFilter(f)` â€” filters live page by sport category
- `openMatchFromBet(eid, sel)` â€” creates fake event from bet selection data for finished matches
- Settlement system works correctly â€” auto-settles every 2 min, auto-voids after 24h

### Files modified:
- `/root/BettingPlatform/backend/public/index.html` (production)
- `/root/BettingPlatform/backend/public/admin.html` (production)
- Same files in `/root/sandbox/BettingPlatform/backend/public/`

### Backups:
- `index.html.backup-20260218` (pre-push)
- `admin.html.backup-20260218` (pre-push)
